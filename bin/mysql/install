#!/usr/bin/env bash

OS=${0/%mysql\/install/system\/check}
OSS=""
if [ -f $OS ];then
    TMP=`${OS}`
    OSS=($TMP)
else
    OS=`curl -L https://raw.githubusercontent.com/wxnacy/wshell/master/bin/system/check_system.sh | bash`
    OSS=(${OS})
fi
SYS=${OSS[0]}
VER=${OSS[1]}

if [ $SYS == 'ubuntu' ];then
    sudo apt update -y
    sudo apt install -y mysql-server
elif [ $SYS == 'centos' ];then
    if [ ! `command -v mysql` ];then
        pkg=mysql80-community-release-el7-1.noarch.rpm
        # sudo yum install -y wget
        # test -f $pkg || wget https://dev.mysql.com/get/$pkg
        sudo rpm -ivh https://dev.mysql.com/get/$pkg
        sudo yum install -y yum-utils
        sudo yum-config-manager --disable mysql80-community
        sudo yum-config-manager --enable mysql57-community
        sudo yum update -y
        # sudo yum install -y mysql-server
        sudo yum install -y mysql-community-server
        sudo systemctl start mysqld
        # rm $pkg
    else
        echo 'Mysql is installed'
    fi

    pass=`sudo grep 'temporary password' /var/log/mysqld.log`
    ps=(${pass})
    echo "Mysql password is: ${ps[-1]}"
elif [ $SYS == 'mac' ];then
    2018-06-27T09:46:58.084829Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: jSl2sq#MGyQD

fi
