#!/usr/bin/env expect

set conf_name [lindex $argv 0]
set conf_dir $env(WSPATH)/mysql.conf

if { $conf_name == "" } {
    set conf_name "local"
}

set conf $conf_dir/$conf_name
puts $conf

if { [file exists $conf] == 0 } {
    puts "Usage: wshell mysql login <configure_path>"
    puts ""
    puts "Or"
    puts ""
    puts "Use command: <ws mysql init> to create conf file"
    exit
}

source $conf

# if { [info exists port] == 0 } {
    # set port 3306
# }
# if { [info exists host] == 0 } {
    # set host localhost
# }
if { [info exists log_dir] } {
    if { [file isdirectory ${log_dir}] == 0 } {
        puts "Directory '${log_dir}' does not exist"
        exit
    }
    set log --tee=${log_dir}/$conf_name.[clock scan 1997].log
} else {
    set log ""
}


spawn sh -c "mysql -u${user} -p -h ${host} ${log}"
expect "*assword:*"
send "${password}\r"
if { [info exists db] } {
    send "use ${db};\r"
}
send "exit;\r"
interact
